var Wizzaro=Wizzaro||{};Wizzaro.namespace=Wizzaro.namespace||function(e){var t,i,l=e.split("."),s=Wizzaro;for("Wizzaro"==l[0]&&(l=l.slice(1)),t=0,i=l.length;t<i;t++)"undefined"==jQuery.type(s[l[t]])&&(s[l[t]]={}),s=s[l[t]];return s},jQuery(document).ready(function(e){new Wizzaro.Plugins.Slider.MetaboxSlides.View.AddedElements}),Wizzaro.namespace("Plugins.Slider.MetaboxSlides"),Wizzaro.Plugins.Slider.MetaboxSlides.Config=Wizzaro.Plugins.Slider.MetaboxSlides.Config||{added_elements_list:{view_no_elements_template:"#wizzaro-slider-metabox-slides-no-elements",container:"#wizzaro-slider-metabox-added-slides",elems_list:".wsms-list",add_new_elem_button:".wsms-add-bt",remove_elems_button:".wsms-remove-selected-bt",select_all_elems_button:".wsms-select-all",unselect_all_elems_button:".wsms-unselect-all",element:{view_template:"#wizzaro-slider-metabox-slides-element",container:".wsms-l-elem",container_class:"wsms-l-elem",image_elem:".wsms-l-e-image img",image_id_input:".wsms-l-e-image input",image_set_button:".wsms-l-e-image .wsms-action-set-image",select_elem_button:".wsms-l-e-select a",delete_elem_button:".wsms-action-delete",selected_class:"wsms-l-elem-selected",placeholder_class:"wsms-l-elem-placeholder",sortable_opatity:.7}}},Wizzaro.namespace("Plugins.Slider.MetaboxSlides.Entity"),Wizzaro.Plugins.Slider.MetaboxSlides.Entity.Element=Backbone.Model.extend({defaults:function(){return{unique_id:0,select:!1}},destroy:function(e){e=e?_.clone(e):{};var t=this,i=e.success,l=e.wait,s=function(){t.stopListening(),t.trigger("destroy",t,t.collection,e)};e.success=function(n){l&&s(),i&&i.call(e.context,t,n,e),t.isNew()||t.trigger("sync",t,n,e)};return _.defer(e.success),l||s(),!1},select:function(){this.set("select",!0)},unselect:function(){this.set("select",!1)},toggleSelect:function(){!0===this.get("select")?this.unselect():this.select()}}),Wizzaro.namespace("Plugins.Slider.MetaboxSlides.Collection"),Wizzaro.Plugins.Slider.MetaboxSlides.Collection.Elements=Backbone.Collection.extend({model:Wizzaro.Plugins.Slider.MetaboxSlides.Entity.Element,getSelectedElements:function(){return this.where({select:!0})}}),Wizzaro.namespace("Plugins.Slider.MetaboxSlides.View"),Wizzaro.Plugins.Slider.MetaboxSlides.View.AddedElements=Backbone.View.extend({el:Wizzaro.Plugins.Slider.MetaboxSlides.Config.added_elements_list.container,config:Wizzaro.Plugins.Slider.MetaboxSlides.Config.added_elements_list,no_elements_template:_.template(jQuery(Wizzaro.Plugins.Slider.MetaboxSlides.Config.added_elements_list.view_no_elements_template).html()),collection:null,$remove_elements_button:null,$elements_list:null,initialize:function(){this.$remove_elements_button=this.$el.find(this.config.remove_elems_button),this.$elements_list=this.$el.find(this.config.elems_list),this.$elements_list.sortable({items:"> "+this.config.element.container,placeholder:this.config.element.placeholder_class,cursor:"move",opacity:this.config.element.sortable_opatity}).disableSelection(),this.collection=new Wizzaro.Plugins.Slider.MetaboxSlides.Collection.Elements,jQuery.each(this.$el.find(this.config.elems_list).find(this.config.element.container),function(e,t){var i=jQuery(t),l=new Wizzaro.Plugins.Slider.MetaboxSlides.Entity.Element({});this.collection.add(l);new Wizzaro.Plugins.Slider.MetaboxSlides.View.Element({el:i,model:l,config:this.config.element,use_template:!1});this.listenTo(l,"change:select",this.toggleDeleteElemsButtonVisible)}.bind(this)),this.listenTo(this.collection,"remove",this.checkEmptyInfo),this.listenTo(this.collection,"remove",this.toggleDeleteElemsButtonVisible),this.$el.find(this.config.add_new_elem_button).on("click",this.addNewElement.bind(this)),this.$el.find(this.config.select_all_elems_button).on("click",this.selectAllElems.bind(this)),this.$el.find(this.config.unselect_all_elems_button).on("click",this.unSelectAllElems.bind(this)),this.$remove_elements_button.on("click",this.removeSelectedElements.bind(this))},filterNoAdedDisplayElement:function(e,t){return!!_.isUndefined(this.collection.findWhere({id:t.get("id")}))&&e},checkEmptyInfo:function(){this.collection.length<=0&&this.$elements_list.html(this.no_elements_template())},addNewElement:function(){this.$elements_list.find("> "+this.config.element.container).length<=0&&this.$elements_list.html("");var e=new Wizzaro.Plugins.Slider.MetaboxSlides.Entity.Element({unique_id:this.collection.length+1});this.collection.add(e);var t=new Wizzaro.Plugins.Slider.MetaboxSlides.View.Element({model:e,config:this.config.element});this.listenTo(e,"change:select",this.toggleDeleteElemsButtonVisible),this.$elements_list.append(t.$el),this.$elements_list.sortable("refresh"),this.checkEmptyInfo()},toggleDeleteElemsButtonVisible:function(){this.collection.getSelectedElements().length>0?this.$remove_elements_button.attr("disabled",!1):this.$remove_elements_button.attr("disabled",!0)},selectAllElems:function(e){e.preventDefault(),e.stopPropagation(),this.collection.invoke("select")},unSelectAllElems:function(e){e.preventDefault(),e.stopPropagation(),this.collection.invoke("unselect")},removeSelectedElements:function(e){e.preventDefault(),e.stopPropagation();var t=this.collection.getSelectedElements();t.length>0&&confirm(wpWizzaroSliderMetaboxSlidesConfig.l10n.delete_elements)&&_.invoke(t,"destroy")}}),Wizzaro.namespace("Plugins.Slider.MetaboxSlides.View"),Wizzaro.Plugins.Slider.MetaboxSlides.View.Element=Backbone.View.extend({config:null,template:null,$imageElem:null,$imageIdInputElem:null,mediaFrame:null,initialize:function(e){this.config=e.config,this.template=_.template(jQuery(this.config.view_template).html()),this.render(e.use_template),this.listenTo(this.model,"change:select",this.markSelected),this.listenTo(this.model,"destroy",this.destroyModel)},render:function(e){!1!==e&&(this.$el.addClass(this.config.container_class),this.$el.html(this.template(this.model.toJSON()))),this.mediaFrame=wp.media({title:wp.media.view.l10n.setFeaturedImage,multiple:!1,state:"featured-image",states:[new wp.media.controller.FeaturedImage]}),this.mediaFrame.on("toolbar:create:featured-image",function(e){this.createSelectToolbar(e,{text:wp.media.view.l10n.setFeaturedImage})},this.mediaFrame),this.mediaFrame.on("select",this.setImage.bind(this)),this.$imageElem=this.$el.find(this.config.image_elem),this.$imageIdInputElem=this.$el.find(this.config.image_id_input),this.$el.find(this.config.image_set_button).on("click",this.openMediaFrame.bind(this)),this.$el.find(this.config.select_elem_button).on("click",this.select.bind(this)),this.$el.find(this.config.delete_elem_button).on("click",this.delete.bind(this))},openMediaFrame:function(e){e.preventDefault(),e.stopPropagation();var t=this.$imageIdInputElem.val();0==t.length&&(t=-1),wp.media.view.settings.post.featuredImageId=t,this.mediaFrame.open()},setImage:function(){var e=this.mediaFrame.state().get("selection").first().toJSON();this.$imageIdInputElem.val(e.id),this.$imageElem.attr("src",e.url),this.$imageElem.show()},select:function(e){e.preventDefault(),e.stopPropagation(),this.model.toggleSelect()},markSelected:function(){!0===this.model.get("select")?this.$el.addClass(this.config.selected_class):this.$el.removeClass(this.config.selected_class)},changeShow:function(){!1===this.model.get("show")&&this.remove()},delete:function(e){e.preventDefault(),e.stopPropagation(),confirm(wpWizzaroSliderMetaboxSlidesConfig.l10n.delete_element)&&this.model.destroy()},destroyModel:function(){this.remove()}});